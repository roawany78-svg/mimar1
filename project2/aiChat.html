<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø¹Ù…Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    :root{
      --accent:#005f46; /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø¹Ù…Ø§Ø± */
      --accent-2:#007c5a; /* Ø¯Ø±Ø¬Ø© Ø£ÙØªØ­ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
      --bg:#f4f7f6;
      --card:#ffffff;
      --muted:#6b7b75;
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:'Tajawal',system-ui,Arial;
      background:linear-gradient(180deg,var(--bg) 0%, #eaf3ef 100%);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      color:#0f172a;
    }

     .chat-app{
      width:100%;
      max-width:980px;
      height:80vh;
      display:grid;
      grid-template-columns:360px 1fr;
      gap:20px;
    }

    .sidebar{
      background:var(--card);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:0 6px 18px rgba(12,20,40,0.06);
      display:flex;
      flex-direction:column;
      gap:12px;
      min-height:0;
    }
    .brand{
      display:flex;align-items:center;gap:12px
    }
    .brand .logo{
      width:48px;height:48px;border-radius:10px;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));
      display:inline-grid;place-items:center;
      overflow:hidden;
    }
    .brand .logo img{
      width:100%;height:100%;object-fit:cover;
    }
    .brand h3{margin:0;font-size:16px}
    .brand p{margin:0;font-size:12px;color:var(--muted)}

    .quick-actions{display:flex;flex-direction:column;gap:8px;margin-top:6px}
    .action{padding:10px;border-radius:12px;border:1px solid #e6efea;cursor:pointer}
    .action:hover{background:#f0f8f4}

    .contractor-preview{margin-top:auto}
    .contractor-preview h4{margin:0 0 8px 0}
    .contractor-card{display:flex;gap:10px;align-items:center;padding:10px;border-radius:12px;border:1px solid #e6efea}
    .contractor-card img{width:54px;height:54px;border-radius:8px;object-fit:cover}
    .contractor-info{flex:1}
    .contractor-info .name{font-weight:600}
    .contractor-info .meta{font-size:12px;color:var(--muted)}

    .chat-area{
      background:linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.9));
      border-radius:var(--radius);
      display:flex;flex-direction:column;overflow:hidden;min-height:0;box-shadow:0 10px 30px rgba(12,20,40,0.06);
    }
    .chat-header{display:flex;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid #e6efea}
    .chat-header .title{font-weight:700;color:var(--accent)}
    .chat-header .desc{color:var(--muted);font-size:13px}

    .messages{
      padding:18px;flex:1;overflow:auto;display:flex;flex-direction:column;gap:12px
    }

    .bubble{max-width:78%;padding:12px 14px;border-radius:16px;line-height:1.4;font-size:15px}
    .bot{align-self:flex-start;background:#fff;border:1px solid #e6efea;color:#0f172a}
    .user{align-self:flex-end;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#fff}

    .suggestions{display:flex;flex-direction:column;gap:10px;margin-top:6px}
    .suggestion-card{display:flex;gap:12px;align-items:center;padding:12px;border-radius:12px;border:1px solid #e6efea;background:#fff}
    .suggestion-card img{width:64px;height:64px;border-radius:8px;object-fit:cover}
    .suggestion-card .info{flex:1}
    .suggestion-card .info .title{font-weight:700}
    .suggestion-card .info .sub{font-size:13px;color:var(--muted)}
    .suggestion-card .actions{display:flex;gap:8px}
    .btn{padding:8px 12px;border-radius:10px;border:none;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#fff}
    .btn.ghost{background:transparent;border:1px solid #cde2d9;color:var(--accent)}

    .composer{padding:14px;border-top:1px solid #e6efea;display:flex;gap:8px;align-items:center}
    .composer input{flex:1;padding:12px 14px;border-radius:12px;border:1px solid #cde2d9;background:transparent;font-size:15px}
    .composer .send{min-width:90px}
    .attach-btn {
  color: var(--accent);
  font-size: 20px;
  cursor: pointer;
  margin: 0 8px;
  display: flex;
  align-items: center;
  transition: color 0.2s;
}

.attach-btn:hover {
  color: var(--accent-2);
}

    .muted{color:var(--muted);font-size:13px}

    @media (max-width:900px){
      .chat-app{grid-template-columns:1fr;align-items:stretch;height:92vh}
      .sidebar{order:2}
      .chat-area{order:1}
    }
  </style>
</head>
<body>


  <div class="chat-app">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">
          <img src="images/mimar_-logo.jpeg" alt="Mimar Logo">
        </div>
        <div>
          <h3>Ù…Ø¹Ù…Ø§Ø±</h3>
          <p>Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø¹Ù…Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ</p>
        </div>
      </div>

      <div class="quick-actions" role="list">
        <div class="action">Ø£Ø­ØªØ§Ø¬ Ø³Ø¨Ø§Ùƒ ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶</div>
        <div class="action">Ù…Ø§ Ù‡ÙŠ ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©ØŸ</div>
        <div class="action">Ø£Ø±ÙŠØ¯ ØªØ±Ø´ÙŠØ­ Ù…Ù‚Ø§ÙˆÙ„ ØªØ±Ù…ÙŠÙ…</div>
        <div class="action">ÙƒÙŠÙ Ø£ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù…Ù‚Ø§ÙˆÙ„ Ø¬Ø¯ÙŠØ¯ØŸ</div>
      </div>

      <div class="contractor-preview">
        <h4>ØªØ±Ø´ÙŠØ­ Ø³Ø±ÙŠØ¹</h4>
        <div class="contractor-card">
          <img src="images/contractorname.jpg" alt="ØµÙˆØ±Ø© Ù…Ù‚Ø§ÙˆÙ„">
          <div class="contractor-info">
            <div class="name"> Ahmed Ali </div>
            <div class="meta">Ø§Ù„Ø±ÙŠØ§Ø¶ â€¢ ØªÙ‚ÙŠÙŠÙ… 4.8</div>
          </div>
        </div>
      </div>
    </aside>

    <main class="chat-area" role="main">
      <header class="chat-header">
        <div>
          <div class="title">Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø¹Ù…Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ</div>
          <div class="desc">Ø§Ø³Ø£Ù„ Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡ ÙŠØ®Øµ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª ÙˆØ³Ø£Ø³Ø§Ø¹Ø¯Ùƒ ÙÙˆØ±Ù‹Ø§</div>
        </div>
      </header>

      <section class="messages" id="messages" aria-live="polite">
        <div class="bubble bot">Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø¹Ù…Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ. ÙƒÙŠÙ Ø£Ù‚Ø¯Ø± Ø£Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ</div>
      </section>

      <div class="composer">
        <input id="inputMessage" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ø£Ùˆ Ø·Ù„Ø¨Ùƒ Ù‡Ù†Ø§..." aria-label="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©">
        <label for="fileInput" class="attach-btn">
        <i class="fa-solid fa-paperclip"></i>
          </label>
            <input type="file" id="fileInput" style="display:none" multiple>
        <button class="btn primary send" id="sendBtn">Ø¥Ø±Ø³Ø§Ù„</button>
      </div>
    </main>
  </div>

  <script>
    const contractors = [
      {id:1,name:'Ø§Ù„Ø³Ø¨Ø§Ùƒ Ø§Ù„Ø°Ù‡Ø¨ÙŠ',trade:'Ø³Ø¨Ø§ÙƒØ©',city:'Ø§Ù„Ø±ÙŠØ§Ø¶',rating:4.9,avatar:'https://images.unsplash.com/photo-1542744173-05336fcc7ad4?w=600&q=80&auto=format&fit=crop'},
      {id:2,name:'ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø§Ù„Ø±ÙŠØ§Ù†',trade:'ÙƒÙ‡Ø±Ø¨Ø§Ø¡',city:'Ø¬Ø¯Ø©',rating:4.7,avatar:'https://images.unsplash.com/photo-1520614073990-dd6020f3b3b0?w=600&q=80&auto=format&fit=crop'},
      {id:3,name:'ØªØ±Ù…ÙŠÙ… Ø§Ù„Ø¨Ù„Ø§Ø¯',trade:'ØªØ±Ù…ÙŠÙ…',city:'Ø§Ù„Ø¯Ù…Ø§Ù…',rating:4.6,avatar:'https://images.unsplash.com/photo-1505691723518-36a6d3ad6b60?w=600&q=80&auto=format&fit=crop'},
      {id:4,name:'Ø´Ø±ÙƒØ© Ø§Ù„Ø¹Ù…Ø§Ø±',trade:'Ù…Ù‚Ø§ÙˆÙ„Ø§Øª Ø¹Ø§Ù…Ø©',city:'Ø§Ù„Ø±ÙŠØ§Ø¶',rating:4.8,avatar:'https://images.unsplash.com/photo-1556767576-cf6f07f1d3d0?w=600&q=80&auto=format&fit=crop'}
    ];

    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('inputMessage');
    const sendBtn = document.getElementById('sendBtn');

    function appendMessage(text,who='bot'){
      const div = document.createElement('div');
      div.className = 'bubble ' + (who==='user'? 'user':'bot');
      div.textContent = text;
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
      return div;
    }

    function showSuggestions(list){
      const container = document.createElement('div');
      container.className='suggestions';
      list.forEach(c=>{
        const card = document.createElement('div');
        card.className='suggestion-card';
        card.innerHTML = `
          <img src="${c.avatar}" alt="${c.name}">
          <div class="info">
            <div class="title">${c.name}</div>
            <div class="sub">${c.trade} Â· ${c.city} Â· â­ ${c.rating}</div>
          </div>
          <div class="actions">
            <button class="btn primary" onclick="contact(${c.id})">Ø¹Ø±Ø¶</button>
          </div>`;
        container.appendChild(card);
      });
      messagesEl.appendChild(container);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    sendBtn.addEventListener('click',sendMessage);
    inputEl.addEventListener('keydown',e=>{if(e.key==='Enter')sendMessage();});

    function sendMessage(){
      const text = inputEl.value.trim();
      if(!text) return;
      appendMessage(text,'user');
      inputEl.value='';

      setTimeout(()=>{
        const reply = aiReply(text);
        appendMessage(reply.text,'bot');
        if(reply.suggestions) showSuggestions(reply.suggestions);
      },700);
    }
    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ø²Ø± Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª
const fileInput = document.getElementById('fileInput');

fileInput.addEventListener('change', () => {
  const files = Array.from(fileInput.files);
  if (!files.length) return;

  files.forEach(file => {
    const fileType = file.type;

    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø§Ù„Ø±Ø³Ø§Ù„Ø© (ÙÙ‚Ø§Ø¹Ø©) Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±ÙÙ‚
    const div = document.createElement('div');
    div.className = 'bubble user';

    if (fileType.startsWith('image/')) {
      const img = document.createElement('img');
      img.src = URL.createObjectURL(file);
      img.style.maxWidth = '180px';
      img.style.borderRadius = '10px';
      div.appendChild(img);
    } 
    else if (fileType.startsWith('video/')) {
      const video = document.createElement('video');
      video.src = URL.createObjectURL(file);
      video.controls = true;
      video.style.maxWidth = '220px';
      video.style.borderRadius = '10px';
      div.appendChild(video);
    } 
    else {
      // Ù…Ù„ÙØ§Øª Ø£Ø®Ø±Ù‰ (PDF, DOCX, ZIP ...)
      const fileLink = document.createElement('a');
      fileLink.href = URL.createObjectURL(file);
      fileLink.download = file.name;
      fileLink.textContent = 'ğŸ“„ ' + file.name;
      fileLink.style.color = '#fff';
      div.appendChild(fileLink);
    }

    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø´Ø§Øª
    document.getElementById('messages').appendChild(div);
    document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
  });

  // Ø¨Ø¹Ø¯ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±ÙÙ‚Ø§ØªØŒ Ù‡Ù†Ø§ Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹ Ù†Ø³ØªØ¯Ø¹ÙŠ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„Ù (backend)
  // Ù…Ø«Ù„:
  // sendFileToAI(file);

  fileInput.value = ''; // ØªÙØ±ÙŠØº Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
});

    function aiReply(text){
      const lower=text.toLowerCase();
      const found=contractors.filter(c=>lower.includes(c.trade)||lower.includes(c.city.toLowerCase()));

      if(found.length>0){
        return {text:`ÙˆØ¬Ø¯Øª ${found.length} Ù…Ù‚Ø§ÙˆÙ„ÙŠÙ† Ù…Ù†Ø§Ø³Ø¨ÙŠÙ† Ù„Ø·Ù„Ø¨ÙƒØŒ ØªÙ‚Ø¯Ø± ØªØ´ÙˆÙÙ‡Ù… Ø£Ø¯Ù†Ø§Ù‡ ğŸ‘‡`,suggestions:found};
      }
      const faq=[
        {q:/ØªØ±Ø§Ø®ÙŠØµ|Ø±Ø®ØµØ©/,a:'ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ø¨Ù†Ø§Ø¡ ØªÙØ³ØªØ®Ø±Ø¬ Ù…Ù† Ù…Ù†ØµØ© Ø¨Ù„Ø¯ÙŠØŒ ÙˆØªØ­ØªØ§Ø¬ Ù…Ø®Ø·Ø· Ù‡Ù†Ø¯Ø³ÙŠ ÙˆØ´Ù‡Ø§Ø¯Ø© Ø³Ù„Ø§Ù…Ø© Ø¥Ù†Ø´Ø§Ø¦ÙŠØ©.'},
        {q:/Ø§Ø³Ø¹Ø§Ø±|ØªÙƒÙ„ÙØ©/,a:'Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ØªØ®ØªÙ„Ù Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ù…Ø³Ø§Ø­Ø©ØŒ ÙŠÙÙØ¶Ù‘Ù„ Ø·Ù„Ø¨ Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ù…Ù† Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ù‚Ø§ÙˆÙ„.'},
        {q:/Ù…Ù‚Ø§ÙˆÙ„/,a:'Ù„Ø¯ÙŠÙ†Ø§ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„ÙŠÙ† Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ† Ø­Ø³Ø¨ Ù…Ø¯ÙŠÙ†ØªÙƒ ÙˆÙ†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŒ ÙÙ‚Ø· Ø§ÙƒØªØ¨ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.'},
        {q:/Ù…Ø¹Ù…Ø§Ø±|Ù…Ù† Ø§Ù†Øª/,a:'Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø¹Ù…Ø§Ø± Ø§Ù„Ø°ÙƒÙŠØŒ Ø£Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ ÙƒÙ„ Ù…Ø§ ÙŠØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª ÙˆØ§Ù„Ø¨Ù†Ø§Ø¡.'}
      ];
      for(const f of faq){if(f.q.test(lower))return {text:f.a};}
      return {text:'Ø³Ø¤Ø§Ù„ Ø¬Ù…ÙŠÙ„! Ø£Ø­ØªØ§Ø¬ ØªÙˆØ¶ÙŠØ­ Ø£ÙƒØ«Ø± Ø­ØªÙ‰ Ø£Ù‚Ø¯Ø± Ø£Ø³Ø§Ø¹Ø¯Ùƒ Ø¨Ø¯Ù‚Ø© ğŸ˜Š'};
    }

    function contact(id){
      const c=contractors.find(x=>x.id===id);
      if(!c)return;
      appendMessage(`ØªÙØ§ØµÙŠÙ„ ${c.name}: ÙŠÙ‚Ø¹ ÙÙŠ ${c.city}ØŒ ØªÙ‚ÙŠÙŠÙ… ${c.rating} â­ Ù„Ù„ØªÙˆØ§ØµÙ„: 05x-xxx-xxxx`,'bot');
    }
    async function sendMessage(){
  const text = inputEl.value.trim();
  if(!text) return;
  appendMessage(text,'user');
  inputEl.value='';

  // Ù…Ø¤Ø´Ø± Ø§Ù†ØªØ¸Ø§Ø±
  const waiting = appendMessage('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ±...','bot');

  try{
    const res = await fetch('http://localhost:3000/api/chat', {
      method:'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ message: text })
    });
    const j = await res.json();

    // Ø§Ø²Ø§Ù„Ø© Ù…Ø¤Ø´Ø± Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
    if(waiting && waiting.parentNode) waiting.parentNode.removeChild(waiting);

    appendMessage(j.reply || 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… ÙŠØ±Ø¯ Ø§Ù„Ù†Ø¸Ø§Ù….');

    if(j.suggestions && j.suggestions.length) showSuggestions(j.suggestions);

  } catch(err){
    console.error(err);
    if(waiting && waiting.parentNode) waiting.parentNode.removeChild(waiting);
    appendMessage('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….','bot');
  }
}

  </script>
</body>
</html>
